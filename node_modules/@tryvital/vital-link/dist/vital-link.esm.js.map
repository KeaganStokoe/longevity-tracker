{"version":3,"file":"vital-link.esm.js","sources":["../src/factory.ts","../src/useVitalLink.tsx","../src/VitalLink.tsx"],"sourcesContent":["import { VitalLinkOptions, Vital } from './types';\n\nexport interface VitalFactory {\n  open: Function;\n  exit: Function;\n  destroy: Function;\n}\n\ninterface FactoryInternalState {\n  vital: Vital | null;\n  open: boolean;\n  onExitCallback: Function | null;\n}\n\nconst renameKeyInObject = (\n  o: { [index: string]: any },\n  oldKey: string,\n  newKey: string\n): object => {\n  const newObject = {};\n  delete Object.assign(newObject, o, { [newKey]: o[oldKey] })[oldKey];\n  return newObject;\n};\n\n/**\n * Wrap link handler creation and instance to clean up iframe via destroy() method\n */\nexport const createVital = (options: VitalLinkOptions) => {\n  const state: FactoryInternalState = {\n    vital: null,\n    open: false,\n    onExitCallback: null,\n  };\n\n  // If Vital is not available, throw an Error\n  if (typeof window === 'undefined' || !window.Vital) {\n    throw new Error('Vital not loaded');\n  }\n\n  const config = renameKeyInObject(\n    options,\n    'publicKey',\n    'key'\n  ) as VitalLinkOptions;\n\n  state.vital = window.Vital.create({\n    ...config,\n    onExit: (...params: any) => {\n      state.open = false;\n      config.onExit && config.onExit(...params);\n      state.onExitCallback && state.onExitCallback();\n    },\n  });\n\n  const open = (token: string) => {\n    if (!state.vital) {\n      return;\n    }\n    state.open = true;\n    state.onExitCallback = null;\n    state.vital.open(token);\n  };\n\n  const exit = (exitOptions: any, callback: Function) => {\n    if (!state.open || !state.vital) {\n      callback && callback();\n      return;\n    }\n    state.onExitCallback = callback;\n    state.vital.exit(exitOptions);\n    if (exitOptions && exitOptions.force) {\n      state.open = false;\n    }\n  };\n\n  const destroy = () => {\n    if (!state.vital) {\n      return;\n    }\n\n    state.vital.destroy();\n    state.vital = null;\n  };\n\n  return {\n    open,\n    exit,\n    destroy,\n  };\n};\n","import { useEffect, useState } from 'react';\nimport useScript from 'react-script-hook';\nimport { VitalLinkOptions } from './types';\nimport { createVital, VitalFactory } from './factory';\n\nconst noop = () => {};\n\nconst VITAL_LINK_STABLE_URL = 'https://link.tryvital.io/initialize.js';\n\n/**\n * This hook loads Vital script and manages the Vital Link creation for you.\n * You get easy open & exit methods to call and loading & error states.\n *\n * This will destroy the Vital UI on un-mounting so it's up to you to be\n * graceful to the user.\n *\n * A new Vital instance is created every time the token and products options change.\n * It's up to you to prevent unnecessary re-creations on re-render.\n */\nexport const useVitalLink = (options: VitalLinkOptions) => {\n  // Asynchronously load the vital/link/stable url into the DOM\n  const [loading, error] = useScript({\n    src: VITAL_LINK_STABLE_URL,\n    checkForExisting: true,\n  });\n\n  // internal state\n  const [vital, setVital] = useState<VitalFactory | null>(null);\n  const [iframeLoaded, setIframeLoaded] = useState(false);\n\n  useEffect(() => {\n    // If the link.js script is still loading, return prematurely\n    if (loading) {\n      return;\n    }\n\n    if (error || !window.Vital) {\n      // eslint-disable-next-line no-console\n      console.error('Error loading Vital', error);\n      return;\n    }\n\n    // if an old vital instance exists, destroy it before\n    // creating a new one\n    if (vital != null) {\n      vital.exit({ force: true }, () => vital.destroy());\n    }\n\n    const next = createVital({\n      ...options,\n      onLoad: () => {\n        setIframeLoaded(true);\n        options.onLoad && options.onLoad();\n      },\n    });\n\n    setVital(next);\n\n    // destroy the Vital iframe factory\n    return () => next.exit({ force: true }, () => next.destroy());\n  }, [loading, error]);\n\n  return {\n    error,\n    ready: vital != null && (!loading || iframeLoaded),\n    exit: vital ? vital.exit : noop,\n    open: vital ? vital.open : noop,\n  };\n};\n","import React from 'react';\n\nimport { VitalLinkPropTypes } from './types';\nimport { useVitalLink } from './useVitalLink';\n\nexport const VitalLink: React.FC<VitalLinkPropTypes> = props => {\n  const { children, style, className, ...config } = props;\n  const { error, open } = useVitalLink({ ...config });\n\n  return (\n    <button\n      disabled={Boolean(error)}\n      type=\"button\"\n      className={className}\n      style={{\n        padding: '6px 4px',\n        outline: 'none',\n        background: '#FFFFFF',\n        border: '2px solid #F1F1F1',\n        borderRadius: '4px',\n        ...style,\n      }}\n      onClick={() => open()}\n    >\n      {children}\n    </button>\n  );\n};\n\nVitalLink.displayName = 'VitalLink';\n"],"names":["renameKeyInObject","o","oldKey","newKey","newObject","Object","assign","createVital","options","state","vital","open","onExitCallback","window","Vital","Error","config","create","onExit","token","exit","exitOptions","callback","force","destroy","noop","VITAL_LINK_STABLE_URL","useVitalLink","useScript","src","checkForExisting","loading","error","useState","setVital","iframeLoaded","setIframeLoaded","useEffect","console","next","onLoad","ready","VitalLink","props","children","style","className","React","disabled","Boolean","type","padding","outline","background","border","borderRadius","onClick","displayName"],"mappings":"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"}